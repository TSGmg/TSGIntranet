<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TSG Intranet - Total Solutions Group</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-orange-50 min-h-screen">
  <div id="root" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"></div>

  <script>
    // --- Initial app state & data (kept your existing data structure) ---
    let state = { currentPage: 'home', searchTerm: '', filterDept: 'all', filterStatus: 'all' };

    const data = {
      announcements: [
        { id: 1, title: 'January Huddle Recap - Slang Game Winners! ðŸŽ‰', date: '2026-01-16', category: 'Huddle', hasImage: false, description: 'Kayla Hoover, Jose Soto, and Elvira Borbon won...' },
        { id: 2, title: 'Invoicing Deadline - January 23rd', date: '2026-01-16', category: 'Accounting', hasImage: false, description: 'Please submit all invoicing to Accounting ASAP. Last day...' },
        { id: 3, title: 'ðŸŽ¯ Unlock the Client Clues Mini Game - NOW LIVE!', date: '2026-01-16', category: 'Mini-Game', hasImage: false, description: 'Earn points by learning about our client...' },
        { id: 4, title: 'Huddlemaster Sign-Up Sheet Posted! ðŸŽ¤', date: '2026-01-16', category: 'Culture', hasImage: false, description: 'Want to lead a huddle? The sign-up sheet is in the main...' },
        { id: 5, title: 'GGOB Culture Committee - Open Roles', date: '2026-01-16', category: 'Opportunities', hasImage: false, description: 'Join the Culture Committee! Roles available: ESOP C...' },
        { id: 6, title: 'ðŸŒ¶ï¸ GOBA Chili Cook-Off & Oyster Roast - Jan 21', date: '2026-01-16', category: 'Event', hasImage: false, description: 'Wed 1/21, 5:30-7:30 PM at Florida Paints Wa...' },
        { id: 7, title: 'ðŸ“š TSG Book Club - "Listening Pays"', date: '2026-01-16', category: 'Book Club', hasImage: false, description: 'Join us every other week (30-45 mins, off the clock) ...' }
      ],
      quickLinks: [
        { name: 'Paychex Time Tracking', url: 'https://login.flex.paychex.com/login_static/UsernameOnly.html?lang=en&downtime=false' },
        { name: 'Ajera - Project Portal', url: 'https://login.ajera.com/' },
        { name: 'EOS Ninety - L10', url: 'https://eos.ninety.io/home' },
        { name: 'The Standard Benefits', url: 'https://login.standard.com/' },
        { name: 'Employee Handbook', url: 'file:///O:/Company%20Handbook/TSG%20Handbook%202024%20rev.%2008.01.24.pdf' },
        { name: 'Training', url: 'https://productivitynow.imaginit.com/#/login' }
      ],
      metrics: [
        { metric: 'Total Billing Projections', value: '$697,000', target: '', status: 'neutral' },
        { metric: 'Actual Invoicing Totals', value: '$79,775', target: 'Goal: $697,000', status: 'behind' },
        { metric: 'Quarter Bonus Progress', value: '($172,850)', target: 'YTD PBT', status: 'behind' },
        { metric: 'Dreams Come True', value: '7,845', target: 'YTD (2025)', status: 'on-track' }
      ],
      // existing employees list taken from your file
      employees: [
        { name: 'Mike Keesee', role: 'Founder & CEO', department: 'Leadership', status: 'online', email: 'mkeesee@mytsghome.com', phone: '(407) 880-2333' },
        { name: 'Carl Brown', role: 'Co-Founder & Engineering Director', department: 'Engineering', status: 'online', email: 'cbrown@mytsghome.com', phone: '(407) 880-2333' },
        { name: 'Alan Smith', role: 'COO', department: 'Leadership', status: 'away', email: 'asmith@mytsghome.com', phone: '(407) 880-2333' },
        { name: 'Allen Beaumont', role: 'Director of Business Development', department: 'Commercial', status: 'online', email: 'abeaumont@mytsghome.com', phone: '(407) 880-2333' },
        { name: 'Michelle Brown', role: 'HR Director', department: 'Leadership', status: 'online', email: 'mbrown@mytsghome.com', phone: '(407) 880-2333' },
        { name: 'Melisa Jones', role: 'Finance Manager', department: 'Leadership', status: 'offline', email: 'mjones@mytsghome.com', phone: '(407) 880-2333' }
      ]
    };

    // --- Helpers ---
    function getInitials(n){ return n.split(' ').map(x=>x[0]).join('').toUpperCase(); }
    function getStatusColor(s){ return {online:'bg-green-500',away:'bg-yellow-500',busy:'bg-red-500',offline:'bg-gray-400'}[s]||'bg-gray-400' }
    function getStatusBadge(s){ return {online:'bg-green-100 text-green-700',away:'bg-yellow-100 text-yellow-700',busy:'bg-red-100 text-red-700',offline:'bg-gray-100 text-gray-700'}[s]||'bg-gray-100 text-gray-700' }

    // --- Simple CSV parser supporting quoted fields ---
    function parseCSV(text) {
      const rows = [];
      let cur = [], val = '', i = 0, inQuotes = false;
      while (i < text.length) {
        const ch = text[i];
        if (inQuotes) {
          if (ch === '"') {
            if (text[i+1] === '"') { val += '"'; i += 2; continue; } // escaped quote
            inQuotes = false; i++; continue;
          } else {
            val += ch; i++; continue;
          }
        } else {
          if (ch === '"') { inQuotes = true; i++; continue; }
          if (ch === ',') { cur.push(val); val = ''; i++; continue; }
          if (ch === '\r') { i++; continue; }
          if (ch === '\n') { cur.push(val); rows.push(cur); cur = []; val = ''; i++; continue; }
          val += ch; i++;
        }
      }
      // finalize
      if (inQuotes) { /* ignore unterminated quote */ }
      if (val !== '' || cur.length > 0) { cur.push(val); rows.push(cur); }
      return rows;
    }

    // --- Merge CSV rows into data.employees by name (case-insensitive) ---
    function mergeCsvIntoEmployees(rows) {
      if (!rows || rows.length < 2) return;
      const header = rows[0].map(h => h.trim());
      const idx = (name) => header.indexOf(name);
      const nameIdx = header.findIndex(h => /name/i.test(h));
      const extIdx = header.findIndex(h => /ext/i.test(h) || /extension/i.test(h));
      const remoteIdx = header.findIndex(h => /remote/i.test(h) || /days/i.test(h));
      for (let r = 1; r < rows.length; r++) {
        const row = rows[r];
        if (!row || row.length === 0) continue;
        const rName = (row[nameIdx] || '').trim();
        if (!rName) continue;
        const rExt = (extIdx >= 0 ? (row[extIdx] || '').trim() : '');
        const rRemote = (remoteIdx >= 0 ? (row[remoteIdx] || '').trim() : '');
        // find existing employee (case-insensitive exact match)
        const found = data.employees.find(e => e.name && e.name.toLowerCase() === rName.toLowerCase());
        if (found) {
          if (rExt) found.extension = rExt;
          if (rRemote) found.remoteDays = rRemote;
        } else {
          // add as a new entry with the CSV data
          data.employees.push({
            name: rName,
            role: '',
            department: '',
            status: 'offline',
            email: '',
            phone: '',
            extension: rExt,
            remoteDays: rRemote
          });
        }
      }
    }

    // --- Load CSV file and merge then re-render ---
    function loadAndMergeCSV() {
      const path = '/data/TSG_Extensions_Remote_Schedule_12.15.25.csv';
      fetch(path)
        .then(resp => {
          if (!resp.ok) throw new Error('CSV fetch failed: ' + resp.status);
          return resp.text();
        })
        .then(text => {
          const rows = parseCSV(text);
          mergeCsvIntoEmployees(rows);
          render(); // re-render after merging
        })
        .catch(err => {
          console.warn('Could not load CSV:', err);
        });
    }

    // --- UI Components (simple render functions) ---
    function Header() {
      return `
        <header class="bg-white shadow-sm border-b border-gray-200 mb-6">
          <div class="py-4 flex items-center justify-between">
            <div>
              <h1 class="text-xl font-semibold">TSG Intranet</h1>
              <p class="text-sm text-gray-500">Total Solutions Group</p>
            </div>
            <nav class="space-x-4">
              <button onclick="navigate('home')" class="px-3 py-1 rounded-md bg-blue-600 text-white">Home</button>
              <button onclick="navigate('directory')" class="px-3 py-1 rounded-md bg-white border">Directory</button>
            </nav>
          </div>
        </header>
      `;
    }

    function HomePage() {
      return `
        <div class="space-y-6">
          <section class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-lg shadow">
            <h2 class="text-2xl font-bold">Welcome to the TSG Intranet</h2>
            <p class="mt-1">Quick links, announcements, and team directory in one place.</p>
          </section>

          <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="col-span-2 bg-white rounded-lg p-4 shadow">
              <h3 class="font-semibold mb-3">Announcements</h3>
              <ul class="space-y-3">${data.announcements.map(a=>`<li class="border rounded p-3"><strong>${a.title}</strong><div class="text-xs text-gray-500">${a.date} â€¢ ${a.category}</div><div class="mt-1 text-sm text-gray-700">${a.description}</div></li>`).join('')}</ul>
            </div>
            <aside class="bg-white rounded-lg p-4 shadow">
              <h3 class="font-semibold mb-3">Quick Links</h3>
              <ul class="space-y-2">${data.quickLinks.map(l=>`<li><a href="${l.url}" class="text-blue-600 hover:underline" target="_blank" rel="noopener">${l.name}</a></li>`).join('')}</ul>
            </aside>
          </section>
        </div>
      `;
    }

    function DirectoryPage() {
      const q = state.searchTerm.trim().toLowerCase();
      let list = data.employees.filter(emp => {
        if (!emp) return false;
        if (state.filterDept !== 'all' && emp.department && emp.department.toLowerCase() !== state.filterDept.toLowerCase()) return false;
        if (state.filterStatus !== 'all' && emp.status && emp.status.toLowerCase() !== state.filterStatus.toLowerCase()) return false;
        if (!q) return true;
        return (emp.name && emp.name.toLowerCase().includes(q))
          || (emp.role && emp.role.toLowerCase().includes(q))
          || (emp.department && emp.department.toLowerCase().includes(q));
      });
      // sort alphabetically
      list = list.sort((a,b)=> (a.name || '').localeCompare(b.name || ''));

      return `
        <div>
          <div class="mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div class="flex items-center gap-2">
              <input oninput="state.searchTerm=this.value; render()" placeholder="Search people, role, department" class="px-3 py-2 border rounded" />
              <select onchange="state.filterDept=this.value; render()" class="px-2 py-2 border rounded">
                <option value="all">All Departments</option>
                <option value="Leadership">Leadership</option>
                <option value="Engineering">Engineering</option>
                <option value="Commercial">Commercial</option>
              </select>
              <select onchange="state.filterStatus=this.value; render()" class="px-2 py-2 border rounded">
                <option value="all">All Statuses</option>
                <option value="online">Online</option>
                <option value="away">Away</option>
                <option value="offline">Offline</option>
              </select>
            </div>
            <div class="text-sm text-gray-600">Showing ${list.length} people</div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            ${list.map(emp => `
              <div class="bg-white p-4 rounded-lg shadow flex gap-4 items-center">
                <div class="flex-shrink-0 w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center text-lg font-semibold">${getInitials(emp.name || '?')}</div>
                <div class="flex-1">
                  <div class="flex justify-between items-start">
                    <div>
                      <div class="font-semibold">${emp.name || ''}</div>
                      <div class="text-sm text-gray-500">${emp.role || ''}${emp.department ? ' â€¢ ' + emp.department : ''}</div>
                    </div>
                    <div class="text-right text-xs ${getStatusBadge(emp.status || 'offline')} px-2 py-1 rounded">${emp.status || 'offline'}</div>
                  </div>
                  <div class="mt-2 text-sm text-gray-600 space-y-1">
                    ${emp.email ? `<div>Email: <a href="mailto:${emp.email}" class="text-blue-600">${emp.email}</a></div>` : ''}
                    ${emp.phone ? `<div>Phone: ${emp.phone}</div>` : ''}
                    ${emp.extension ? `<div>Ext: ${emp.extension}</div>` : ''}
                    ${emp.remoteDays ? `<div>Remote: ${emp.remoteDays}</div>` : ''}
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function Footer() {
      return `
        <footer class="bg-white border-t border-gray-200 mt-12 py-6 text-center text-sm text-gray-500 rounded">
          Â© ${new Date().getFullYear()} Total Solutions Group
        </footer>
      `;
    }

    // --- Router / Renderer ---
    function render() {
      const root = document.getElementById('root');
      let content = '';
      content += Header();
      if (state.currentPage === 'home') content += HomePage();
      else if (state.currentPage === 'directory') content += DirectoryPage();
      content += Footer();
      root.innerHTML = content;
    }

    function navigate(page) {
      state.currentPage = page;
      state.searchTerm = '';
      state.filterDept = 'all';
      state.filterStatus = 'all';
      render();
      window.scrollTo(0,0);
    }

    // Expose navigate for header buttons
    window.navigate = navigate;

    // Initial render
    render();

    // Load CSV from repo and merge on page load (re-renders after merge)
    loadAndMergeCSV();

  </script>
</body>
</html>